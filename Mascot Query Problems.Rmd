---
title: "Uncertainties in mascot queries"
output: html_document
---

##Setup

```{r}
library(tidyverse)
source("R/01.2 - read_mascot.R")

query_dupes <- function(mascot_tbl = mascot){
  mascot_tbl %>%
  group_by(query_number) %>%
  filter(n() > 1) %>%
  arrange(query_number, desc(pep_score)) %>%
  return()
}
query_choice <- function(mascot_tbl = mascot, query_tbl = query){
  query_tbl %>%
  semi_join(mascot_tbl, "query_number") %>%
  group_by(query_number) %>%
  filter(n() >= 2) %>%
  filter(sum(!is.na(pep_score)) >= 1) %>%
  filter(pep_score == max(pep_score, na.rm = T)) %>%
  ungroup() %>%
  anti_join(mascot_tbl, c("query_number", "pep_score")) %>%
  arrange(desc(pep_score)) %>%
  return()
}
```

*All R functions, scripts and data used can be found under*
*https://github.com/kbajdzienko/Phosphoproteomics*


#Mascot OUTPUT 1

> FILE: DATA\EXP19_3_PSBD_mascot_peptides_and_query.csv

| Setting                  | State  |
|--------------------------|:------:|
|Subset protein families   | ACTIVE |
|Sameset protein families  | OFF    |
|Ions score cut-off        | OFF    |
|Group protein families    | ACTIVE |
|Duplicate peptides        | ACTIVE |
|Require Bold Red          | OFF    |

*This is default Mascot OUTPUT we use (setup by server administrator)

##Case 1: More than one peptide from the same query(MS/MS scan) in final output
```{r}
mascot <- read.mascot("DATA/F011845.csv", "pep")
query_dupes()
```


##Case 2: Query result with lower score is picked for mascot peptide table
```{r}
query <- read.mascot("DATA/F011845.csv", "query")
query_choice()
```
### Confirmation on an example: 923
```{r}
filter(mascot, query_number == "923") %>% select(query_number, pep_score, everything())
filter(query, query_number == "923") %>% select(query_number, pep_score, everything())
```

#Mascot OUTPUT 2

> FILE: DATA\F011845_19-3_strictexportfilter.csv*

| Setting                  | State  |
|--------------------------|:------:|
|Subset protein families   | OFF    |
|Sameset protein families  | OFF    |
|Ions score cut-off        | **5**  |
|Group protein families    | ACTIVE |
|Duplicate peptides        | OFF    |
|Require Bold Red          | OFF    |

##Case 1: More than one peptide from the same query (MS/MS scan) in final output
```{r}
mascot <- read.mascot("DATA/F011845_strict_ionscutoff5.csv")
query_dupes()
```

##Case 2: Query result with lower score is picked for mascot peptide table
```{r}
query <- read.mascot("DATA/F011845_strict_ionscutoff5.csv", "query")
query_choice()
```
### Confirmation on an example: 33142
```{r}
filter(mascot, query_number == "33142") %>% select(query_number, pep_score, everything())
filter(query, query_number == "33142") %>% select(query_number, pep_score, everything())
```

#Mascot OUTPUT 3

> FILE: DATA\F011845_19-3_BOLDRED.csv*

| Setting                  | State  |
|--------------------------|:------:|
|Subset protein families   | ACTIVE |
|Sameset protein families  | OFF    |
|Ions score cut-off        | OFF    |
|Group protein families    | OFF    |
|Duplicate peptides        | ACTIVE |
|Require Bold Red          | ACTIVE |

*Red peptides are peptides with score above significance threshold, that is calculated by Mascot based on mass accuracy settings and number of variable modifications.

Bold peptides are the best match for an Accession.*

##Case 1: More than one peptide from the same query (MS/MS scan) in final output
```{r}
mascot <- read.mascot("DATA/F011845_BOLDRED.csv")
query_dupes()
```

##Case 2: Query result with lower score is picked for mascot peptide table
```{r}
query <- read.mascot("DATA/F011845_BOLDRED.csv", "query")
query_choice()
```
### Confirmation on an example: 5306
```{r}
filter(mascot, query_number == "5306") %>% select(query_number, pep_score, everything())
filter(query, query_number == "5306") %>% select(query_number, pep_score, everything())
```

#Mascot OUTPUT 4

> FILE: DATA\F011845_19-3_boldred_strict.csv*

| Setting                  | State  |
|--------------------------|:------:|
|Subset protein families   | OFF |
|Sameset protein families  | OFF    |
|Ions score cut-off        | **5**  |
|Group protein families    | OFF   |
|Duplicate peptides        | OFF |
|Require Bold Red          | ACTIVE |

##Case 1: More than one peptide from the same query (MS/MS scan) in final output
```{r}
mascot <- read.mascot("DATA/F011845_boldred_strict.csv")
query_dupes()
```

##Case 2: Query result with lower score is picked for mascot peptide table
```{r}
query <- read.mascot("DATA/F011845_boldred_strict.csv", "query")
query_choice()
```
### Confirmation on an example: 33142
```{r}
filter(mascot, query_number == "33142") %>% select(query_number, pep_score, everything())
filter(query, query_number == "33142") %>% select(query_number, pep_score, everything())
```

#Mascot OUTPUT 5

> FILE: DATA\F011845_19-3_boldred_strict.csv*

| Setting                  | State  |
|--------------------------|:------:|
|Subset protein families   | OFF |
|Sameset protein families  | OFF    |
|Ions score cut-off        | **5**  |
|Group protein families    | OFF   |
|Duplicate peptides        | OFF |
|Require Bold Red          | ACTIVE |

##Case 1: More than one peptide from the same query (MS/MS scan) in final output
```{r}
mascot <- read.mascot("DATA/F011845_ions10.csv")
query_dupes()
```

##Case 2: Query result with lower score is picked for mascot peptide table
```{r}
query <- read.mascot("DATA/F011845_ions10.csv", "query")
query_choice()
```
